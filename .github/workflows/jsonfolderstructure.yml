- name: Generate folder JSON
# Trigger on push to main and manually
on:
  push:
    branches:
      - main
  workflow_dispatch:  # <-- this allows on-demand runs
  
  run: |
    python <<EOF
    import os, json
    addon_dir='ankimon/src/'
    json_file_structure='folder_structure.json'
    exclude_folders=['__pycache__']
    def folder_to_dict(path):
        if os.path.basename(path) in exclude_folders: return None
        d={'name':os.path.basename(path),'type':'folder','children':[]}
        try:
            for i in os.listdir(path):
                p=os.path.join(path,i)
                d['children'].append(folder_to_dict(p) if os.path.isdir(p) else {'name':i,'type':'file'})
        except PermissionError:
            d['children'].append({'name':'Permission Denied','type':'error'})
        return d
    structure=folder_to_dict(addon_dir) or {'name':'root','type':'folder','children':[]}
    json.dump(structure, open(json_file_structure,'w'), indent=4)
    EOF
